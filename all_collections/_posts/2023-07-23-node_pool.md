---
layout: post
title: ğŸ— ì•„ë¦„ë‹µë‹¤. node pool[4í¸]
date: 2023-07-23
categories: ["SamBeak", "Pool", "Mysql2", "createPool", "Node"]
---

> # AWS RDSë¥¼ ìƒì„±í–ˆë‹¤ë©´, ì‚¬ìš©í•´ë³´ì

<br>
AWSì—ì„œ RDSë¥¼ ìƒì„±í•˜ê³  ì„¤ì •í–ˆë‹¤ë©´, <br>
Nodeë¡œ ì‚¬ìš©í•´ë³´ë„ë¡í•˜ì. <br>
ìš°ì„ ì€, mysql2 íŒ¨í‚¤ì§€ ëª¨ë“ˆì„ ì„¤ì¹˜í•œë‹¤. <br>
ì°¸, RDSí¸ì—ì„œ ìƒì„¸í•œ ì„¤ì • ë‚´ìš©ì€ ìƒëµí–ˆì§€ë§Œ, <br>
RDSì—ì„œ ì„¤ì •í•œ ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë“ˆì„ ì„¤ì¹˜í•œë‹¤ê³  ìƒê°í•˜ì. <br>
mysql(auroraê°€ ì•„ë‹ˆë‹¤.)ì„ ì„¤ì •í–ˆìœ¼ë‹ˆ ëª¨ë“ˆë„ mysqlë¡œ ì„¤ì¹˜í•œë‹¤. <br>

```JavaScript
const mysql = require('mysql2');
```

npmì˜ ê³µì‹ ì‚¬ì´íŠ¸ì— ë“¤ì–´ê°€ë©´ ëª¨ë“ˆì— ëŒ€í•œ ì„¤ëª…ì„ ì°¾ì•„ë³¼ ìˆ˜ ìˆë‹¤. <br>
mysql2ë¥¼ ê²€ìƒ‰í•´ë³´ë©´ ì–´ë–»ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ì§€ ì„¸ì„¸í•˜ê²Œ ë‚˜ì˜¤ëŠ”ë° <br>
ì˜¤ëŠ˜ ì •ë¦¬í•  ê²ƒì€ createPool ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤. <br>
poolì€ ë‚´ í”„ë¡œì íŠ¸ì™€ RDSë¥¼ ì—°ê²°í•´ì£¼ëŠ” ì—­í• ì„ í•œë‹¤. <br><br>

```JavaScript
const pool = mysql.createPool({
    host: "", // RDS DB ì—”ë“œí¬ì¸íŠ¸
    user: "admin",
    password: "",
    port: 3306,
    database: "db_test",
  });
```

ìœ„ ì˜ˆì‹œë¥¼ ë³´ë©´ hostì—ëŠ” RDS DB ì—”ë“œí¬ì¸íŠ¸ê°€ ë“¤ì–´ê°€ê³  <br>
user, pw, portëŠ” ì „ë¶€ RDS ìƒì„±í•  ë•Œ ì„¤ì •í•œ ë‚´ìš©ì´ë‹¤. <br>
databaseëŠ” ì—†ë‹¤ë©´ ì²˜ìŒì—” ê³µë€ìœ¼ë¡œ ì‹œì‘í•˜ê³  <br>
RDSìƒì„±í•  ë•Œ ì¶”ê°€ì‚¬í•­ì—ì„œ ì²˜ìŒ ìƒì„±ì‹œ DB ìƒì„±ì„ ì„¤ì •í–ˆë‹¤ë©´ <br>
í•´ë‹¹ ì´ë¦„ì„ ë„£ì–´ì£¼ë©´ ëœë‹¤. <br>
ì´ë ‡ê²Œ í•˜ë©´ ì´ì œ ë‚´ í”„ë¡œì íŠ¸ì™€ RDSëŠ” ì—°ê²° ëœ ê²ƒì´ë‹¤. <br><br>

> # poolì„ ì‚¬ìš©í•´ë³´ì

<br>
RDSì™€ ì—°ê²°ì´ ëë‹¤ë©´ ì´ì œ ë³¸ê²©ì ìœ¼ë¡œ ì‚¬ìš©í•´ë³´ì <br>
DBì— ë­”ê°€ë¥¼ í•˜ê¸° ìœ„í•´ì„  ìŒ, CRUD ì‘ì—… ë“±ì„ í•˜ê¸° ìœ„í•´ì„  <br>
query ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤. <br>
poolì˜ queryí•¨ìˆ˜ëŠ” ì´ë ‡ê²Œ ì‘ì„±í•œë‹¤. <br>

```JavaScript
pool.query(`SQLë¬¸`, function(err, res, fields){
    console.log(res);
    };
);
```

ê·¸ëŸ¼ RDSì˜ DBì— í•´ë‹¹ SQLë¬¸ì„ ì ìš©ì‹œí‚¤ê³  <br>
ì´ë•Œ errì€ ì—ëŸ¬, resëŠ” ê²°ê³¼, fieldsëŠ” í•„ë“œë¥¼ ë‚˜íƒ€ë‚¸ë‹¤. <br><br>

> # DB ìƒì„±ê³¼ í…Œì´ë¸” ìƒì„±

<br>
poolì˜ ëª¨ìŠµì„ ì •ë¦¬í–ˆìœ¼ë‹ˆ ì´ì œ ì½”ë“œë¡œë§Œ ì •ë¦¬í•˜ê³ ì í•œë‹¤. <br>

```JavaScript
// db talbe ìƒì„±
pool.query(`create table notes(
  uuid BINARY(16) DEFAULT (UUID_TO_BIN(UUID())),
  title VARCHAR(255) NOT NULL,
  contents TEXT NOT NULL,
  created TIMESTAMP NOT NULL DEFAULT NOW()
);`, function (err, results, fields) {
  console.log(results);
});

// db ë‚´ìš© ì¶”ê°€
pool.query(`insert into notes(title, contents) values('My First Note', 'A note about something'), ('My Second Note', 'A note about something else');`, function (err, results, fields) {
  console.log(results);
});

```

> # pool CRUDí•¨ìˆ˜ êµ¬í˜„

<br>

```JavaScript

// select í•¨ìˆ˜ ë§Œë“¤ê¸°
function getNotes(){
    pool.query(`select BIN_TO_UUID(uuid,true) as uuid,title,contents,created from notes`, function (err, results, fields) {
    console.log(results);
    });
}

// select í•¨ìˆ˜2 ë§Œë“¤ê¸°
function getNote(uuid){
    pool.query(`select BIN_TO_UUID(uuid,true) as uuid,title,contents,created from notes where uuid=UUID_TO_BIN('${uuid}', 1);`, function (err, results, fields) {
    // console.log(results); // ë³µìˆ˜ë¡œ ê°€ì ¸ì˜¨ë‹¤. ë°°ì—´ì²˜ëŸ¼ [{}] ì´ë ‡ê²Œ ê°€ì ¸ì˜¨ë‹¤.
    console.log(...results); // ë‹¨ìˆ˜ë¡œ ê°€ì ¸ì˜¨ë‹¤. {} ì´ë ‡ê²Œ ê°€ì ¸ì˜¨ë‹¤.
    });
};

// insert í•¨ìˆ˜ ë§Œë“¤ê¸°
function addNotes(title,contents){
    pool.query(`insert into notes(title, contents) values('${title}','${contents}');`, function (err, results, fields) {
    console.log(results);
    });
};

// update í•¨ìˆ˜ ë§Œë“¤ê¸°
function updateNotes(uuid,title,contents){
    pool.query(`update notes set title='${title}', contents='${contents}' where uuid=UUID_TO_BIN('${uuid}', 1);`, function (err, results, fields) {
    console.log(results);
    });
}

// delete í•¨ìˆ˜ ë§Œë“¤ê¸°
function deleteNotes(uuid){
    pool.query(`delete from notes where uuid=UUID_TO_BIN('${uuid}', 1);`, function (err, results, fields) {
    console.log(results);
    });
}
```
